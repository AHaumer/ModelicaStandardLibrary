<html><head><title>Modelica.Blocks.Continuous.Internal.Filter.Utilities</title></head>
<style>
body { font-family: Droid Serif,serif; font-size: 16px; line-height: 24px;  }
p, dt, pre, blockquote, ol, ul, table, hr { margin-top: 24px; margin-bottom: 0 }
img { margin-top: 24px }
img.icon, embed.icon { float: right; margin: 0 0 24px 24px; border: 0 }
h1, h2, h3, h4, h5, th { font-family: Droid Sans,sans-serif }
h1 { font-size: 26px; line-height: 26px; margin: 18px 0 0 0 }h2 { font-size: 21px; line-height: 24px; margin: 26px 0 -2px 0 }h3 { font-size: 18px; line-height: 24px; margin: 27px 0 -3px 0 }h4 { font-size: 16px; line-height: 24px; margin: 28px 0 -4px 0; font-style: italic }h1 .subtitle, h2 .subtitle { font-size: 16px; font-style: italic }
h1 br, h2 br { margin-bottom: 10px }
p.interface { background-color: #EEE; padding: 20px; border: 1px solid #CCE; border-radius: 14px }
code, pre, p.interface { font-family: Droid Sans Mono,monospace; font-size: 14px; line-height: 20px }
li, dd, li p, dd p, li dt, dd dt, li pre, dd pre, li blockquote, dd blockquote, li table, dd table { margin-top: 11px; margin-bottom: 11px }
dt + dt, dd, ul ul { margin-top: 0 }
blockquote pre, blockquote blockquote { margin-top: 0; margin-bottom: 0 }
ul ul li { margin-top:5px; margin-bottom:6px }
td, th { vertical-align: top; font-size: 14px; line-height: 20px }
th { background-color: #EEE }
td p, th p { margin-top: 10px }
td code, th code { font-size: 13px }
hr { border: 0; border-bottom: 1px dotted darkred; clear: right }
</style>
<body>
<a name="Utilities"><h1><embed class="icon" src="../../../../../images/icon0034.svg" width="203" height="203" />
Package <a href="../../../../../index.html">Modelica</a>.&#8203;<a href="../../../../index.html">Blocks</a>.&#8203;<a href="../../../index.html">Continuous</a>.&#8203;<a href="../../index.html">Internal</a>.&#8203;<a href="../index.html">Filter</a>.&#8203;Utilities<br><span class="subtitle">Utility functions for filter computations</span></h1></a>
<h3>Information</h3>
<p>


<p>
This icon shall be used for a package that contains internal classes not to be
directly utilized by a user.
</p>
<p>Extends from <code><a href="../../../../../Icons/InternalPackage/index.html">Modelica.&#8203;Icons.&#8203;InternalPackage</a></code> (Icon for an internal package (indicating that the package should not be directly utilized by user)).</p>
<h3>Package Contents</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Name</th><th>Description</th></tr><tr><td><a href="#bandPassAlpha"><code>bandPassAlpha</code></a></td><td>Return alpha for band pass</td></tr>
<tr><td><a href="#BesselBaseCoefficients"><code>BesselBaseCoefficients</code></a></td><td>Return coefficients of normalized low pass Bessel filter (= gain at cut-off frequency 1 rad/s is decreased 3dB)</td></tr>
<tr><td><a href="#normalizationFactor"><code>normalizationFactor</code></a></td><td>Compute correction factor of low pass filter such that amplitude at cut-off frequency is -3db (=10^(-3/20) = 0.70794...)</td></tr>
<tr><td><a href="#toHighestPowerOne"><code>toHighestPowerOne</code></a></td><td>Transform filter to form with highest power of s equal 1</td></tr>
</table>
<hr><a name="BesselBaseCoefficients"><h2><embed class="icon" src="../../../../../images/icon0035.svg" width="203" height="203" />
Function <a href="../../../../../index.html">Modelica</a>.&#8203;<a href="../../../../index.html">Blocks</a>.&#8203;<a href="../../../index.html">Continuous</a>.&#8203;<a href="../../index.html">Internal</a>.&#8203;<a href="../index.html">Filter</a>.&#8203;<a href="index.html">Utilities</a>.&#8203;BesselBaseCoefficients<br><span class="subtitle">Return coefficients of normalized low pass Bessel filter (= gain at cut-off frequency 1 rad/s is decreased 3dB)</span></h2></a>
<h3>Information</h3>
<p>
<p>The transfer function H(p) of a <em>n</em> 'th order Bessel filter is given by</p>
<blockquote><pre>
        Bn(0)
H(p) = -------
        Bn(p)
 </pre>
</blockquote>
<p>with the denominator polynomial</p>
<blockquote><pre>
         n             n  (2n - k)!       p^k
Bn(p) = sum c_k*p^k = sum ----------- * -------   (1)
        k=0           k=0 (n - k)!k!    2^(n-k)
</pre></blockquote>
<p>and the numerator</p>
<blockquote><pre>
               (2n)!     1
Bn(0) = c_0 = ------- * ---- .                    (2)
                n!      2^n
 </pre></blockquote>
<p>Although the coefficients c_k are integer numbers, it is not advisable to use the
polynomials in an unfactorized form because the coefficients are fast growing with order
n (c_0 is approximately 0.3e24 and 0.8e59 for order n=20 and order n=40
respectively).</p>

<p>Therefore, the polynomial Bn(p) is factorized to first and second order polynomials with
real coefficients corresponding to zeros and poles representation that is used in this library.</p>

<p>The function returns the coefficients which resulted from factorization of the normalized transfer function</p>
<blockquote><pre>
H'(p') = H(p),  p' = p/w0
</pre></blockquote>
<p>as well as</p>
<blockquote><pre>
alpha = 1/w0
</pre></blockquote>
<p>the reciprocal of the cut of frequency w0 where the gain of the transfer function is
decreased 3dB.</p>

<p>Both, coefficients and cut off frequency were calculated symbolically and were eventually evaluated
with high precision calculation. The results were stored in this function as real
numbers.</p>

<h4>Calculation of normalized Bessel filter coefficients</h4>
<p>Equation</p>
<blockquote><pre>
abs(H(j*w0)) = abs(Bn(0)/Bn(j*w0)) = 10^(-3/20)
</pre></blockquote>
<p>which must be fulfilled for cut off frequency w = w0 leads to</p>
<blockquote><pre>
[Re(Bn(j*w0))]^2 + [Im(Bn(j*w0))]^2 - (Bn(0)^2)*10^(3/10) = 0
</pre></blockquote>
<p>which has exactly one real solution w0 for each order n. This solutions of w0 are
calculated symbolically first and evaluated by using high precise values of the
coefficients c_k calculated by following (1) and (2).</p>

<p>With w0, the coefficients of the factorized polynomial can be computed by calculating the
zeros of the denominator polynomial</p>
<blockquote><pre>
        n
Bn(p) = sum w0^k*c_k*(p/w0)^k
        k=0
</pre></blockquote>
<p>of the normalized transfer function H'(p'). There exist n/2 of conjugate complex
pairs of zeros (beta +-j*gamma) if n is even and one additional real zero (alpha) if n is
odd. Finally, the coefficients a, b1_k, b2_k of the polynomials</p>
<blockquote><pre> a*p + 1,  n is odd </pre></blockquote>
<p>and</p>
<blockquote><pre>
b2_k*p^2 + b1_k*p + 1,   k = 1,... div(n,2)
</pre></blockquote>
<p>results from</p>
<blockquote><pre>
a = -1/alpha
</pre></blockquote>
<p>and</p>
<blockquote><pre>
b2_k = 1/(beta_k^2 + gamma_k^2) b1_k = -2*beta_k/(beta_k^2 + gamma_k^2)
</pre></blockquote>
<p>Extends from <code><a href="../../../../../Icons/index.html#Function">Modelica.&#8203;Icons.&#8203;Function</a></code> (Icon for functions).</p>
<h3>Inputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Integer</code></td><td><code>order</code></td><td>Order of filter in the range 1..41</td></tr>
</table>
<h3>Outputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>c1[mod(order, 2)]</code></td><td>[p] coefficients of Bessel denominator polynomials (a*p + 1)</td></tr>
<tr><td><code>Real</code></td><td><code>c2[integer(0.5 * order),2]</code></td><td>[p^2, p] coefficients of Bessel denominator polynomials (b2*p^2 + b1*p + 1)</td></tr>
<tr><td><code>Real</code></td><td><code>alpha</code></td><td>Normalization factor</td></tr>
</table>
<hr><a name="toHighestPowerOne"><h2><embed class="icon" src="../../../../../images/icon0035.svg" width="203" height="203" />
Function <a href="../../../../../index.html">Modelica</a>.&#8203;<a href="../../../../index.html">Blocks</a>.&#8203;<a href="../../../index.html">Continuous</a>.&#8203;<a href="../../index.html">Internal</a>.&#8203;<a href="../index.html">Filter</a>.&#8203;<a href="index.html">Utilities</a>.&#8203;toHighestPowerOne<br><span class="subtitle">Transform filter to form with highest power of s equal 1</span></h2></a>
<h3>Information</h3>
<p>

<p>This icon indicates Modelica functions.</p>
<p>Extends from <code><a href="../../../../../Icons/index.html#Function">Modelica.&#8203;Icons.&#8203;Function</a></code> (Icon for functions).</p>
<h3>Inputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>den1[:]</code></td><td>[s] coefficients of polynomials (den1[i]*s + 1)</td></tr>
<tr><td><code>Real</code></td><td><code>den2[:,2]</code></td><td>[s^2, s] coefficients of polynomials (den2[i,1]*s^2 + den2[i,2]*s + 1)</td></tr>
</table>
<h3>Outputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>cr[size(den1, 1)]</code></td><td>[s^0] coefficients of polynomials cr[i]*(s+1/cr[i])</td></tr>
<tr><td><code>Real</code></td><td><code>c0[size(den2, 1)]</code></td><td>[s^0] coefficients of polynomials (s^2 + (den2[i,2]/den2[i,1])*s + (1/den2[i,1]))</td></tr>
<tr><td><code>Real</code></td><td><code>c1[size(den2, 1)]</code></td><td>[s^1] coefficients of polynomials (s^2 + (den2[i,2]/den2[i,1])*s + (1/den2[i,1]))</td></tr>
</table>
<hr><a name="normalizationFactor"><h2><embed class="icon" src="../../../../../images/icon0035.svg" width="203" height="203" />
Function <a href="../../../../../index.html">Modelica</a>.&#8203;<a href="../../../../index.html">Blocks</a>.&#8203;<a href="../../../index.html">Continuous</a>.&#8203;<a href="../../index.html">Internal</a>.&#8203;<a href="../index.html">Filter</a>.&#8203;<a href="index.html">Utilities</a>.&#8203;normalizationFactor<br><span class="subtitle">Compute correction factor of low pass filter such that amplitude at cut-off frequency is -3db (=10^(-3/20) = 0.70794...)</span></h2></a>
<h3>Information</h3>
<p>

<p>This icon indicates Modelica functions.</p>
<p>Extends from <code><a href="../../../../../Icons/index.html#Function">Modelica.&#8203;Icons.&#8203;Function</a></code> (Icon for functions).</p>
<h3>Inputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>c1[:]</code></td><td>[p] coefficients of denominator polynomials (c1[i}*p + 1)</td></tr>
<tr><td><code>Real</code></td><td><code>c2[:,2]</code></td><td>[p^2, p] coefficients of denominator polynomials (c2[i,1]*p^2 + c2[i,2]*p + 1)</td></tr>
</table>
<h3>Outputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>alpha</code></td><td>Correction factor (replace p by alpha*p)</td></tr>
</table>
<hr><a name="bandPassAlpha"><h2><embed class="icon" src="../../../../../images/icon0035.svg" width="203" height="203" />
Function <a href="../../../../../index.html">Modelica</a>.&#8203;<a href="../../../../index.html">Blocks</a>.&#8203;<a href="../../../index.html">Continuous</a>.&#8203;<a href="../../index.html">Internal</a>.&#8203;<a href="../index.html">Filter</a>.&#8203;<a href="index.html">Utilities</a>.&#8203;bandPassAlpha<br><span class="subtitle">Return alpha for band pass</span></h2></a>
<h3>Information</h3>
<p>

<p>
A band pass with bandwidth "w" is determined from a low pass
</p>

<pre>
  1/(p^2 + a*p + b)
</pre>

<p>
with the transformation
</p>

<pre>
  new(p) = (p + 1/p)/w
</pre>

<p>
This results in the following derivation:
</p>

<pre>
  1/(p^2 + a*p + b) -> 1/( (p+1/p)^2/w^2 + a*(p + 1/p)/w + b )
                     = 1 /( ( p^2 + 1/p^2 + 2)/w^2 + (p + 1/p)*a/w + b )
                     = w^2*p^2 / (p^4 + 2*p^2 + 1 + (p^3 + p)a*w + b*w^2*p^2)
                     = w^2*p^2 / (p^4 + a*w*p^3 + (2+b*w^2)*p^2 + a*w*p + 1)
</pre>

<p>
This 4th order transfer function shall be split in to two transfer functions of order 2 each
for numerical reasons. With the following formulation, the fourth order
polynomial can be represented (with the unknowns "c" and "alpha"):
</p>

<pre>
  g(p) = w^2*p^2 / ( (p*alpha)^2 + c*(p*alpha) + 1) * ( (p/alpha)^2 + c*(p/alpha) + 1)
       = w^2*p^2 / ( p^4 + c*(alpha + 1/alpha)*p^3 + (alpha^2 + 1/alpha^2 + c^2)*p^2
                                                   + c*(alpha + 1/alpha)*p + 1 )
</pre>

<p>
Comparison of coefficients:
</p>

<pre>
  c*(alpha + 1/alpha) = a*w           -> c = a*w / (alpha + 1/alpha)
  alpha^2 + 1/alpha^2 + c^2 = 2+b*w^2 -> equation to determine alpha

  alpha^4 + 1 + a^2*w^2*alpha^4/(1+alpha^2)^2 = (2+b*w^2)*alpha^2
    or z = alpha^2
  z^2 + a^2*w^2*z^2/(1+z)^2 - (2+b*w^2)*z + 1 = 0
</pre>

<p>
Therefore the last equation has to be solved for "z" (basically, this means to compute
a real zero of a fourth order polynomial):
</p>

<pre>
   solve: 0 = f(z)  = z^2 + a^2*w^2*z^2/(1+z)^2 - (2+b*w^2)*z + 1  for "z"
              f(0)  = 1  &gt; 0
              f(1)  = 1 + a^2*w^2/4 - (2+b*w^2) + 1
                    = (a^2/4 - b)*w^2  &lt; 0
                    // since b - a^2/4 > 0 requirement for complex conjugate poles
   -> 0 &lt; z &lt; 1
</pre>

<p>
This function computes the solution of this equation and returns "alpha = sqrt(z)";
</p>

<p>Extends from <code><a href="../../../../../Icons/index.html#Function">Modelica.&#8203;Icons.&#8203;Function</a></code> (Icon for functions).</p>
<h3>Inputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>a</code></td><td>Coefficient of s^1</td></tr>
<tr><td><code>Real</code></td><td><code>b</code></td><td>Coefficient of s^0</td></tr>
<tr><td><code><a href="../../../../../SIunits/index.html#AngularVelocity">AngularVelocity</a></code></td><td><code>w</code></td><td>Bandwidth angular frequency</td></tr>
</table>
<h3>Outputs</h3>
<table border="1" cellspacing="0" cellpadding="3">
<tr><th>Type</th><th>Name</th><th>Description</th></tr><tr><td><code>Real</code></td><td><code>alpha</code></td><td>Alpha factor to build up band pass</td></tr>
</table>
<hr style="border-color:#999" />
<p style="font-size:80%;color:#999;margin-top:12px">Generated 2018-10-22 14:44:41 EDT by <i>MapleSim</i>.</p>
</body></html>
